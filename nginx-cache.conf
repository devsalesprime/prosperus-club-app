# ==============================================
# PROSPERUS CLUB PWA - NGINX CACHE CONFIGURATION
# ==============================================
# Adicione este bloco dentro do server {} do seu VPS
# Garante que o Service Worker é sempre verificado
# e que assets cacheados usem fingerprint do Vite

# Service Worker - NUNCA cachear (critical!)
# O navegador DEVE sempre buscar a versão mais recente
location = /app/sw.js {
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
    add_header Service-Worker-Allowed "/app/";
    expires off;
    etag off;
    if_modified_since off;
}

# HTML (index.html, manifest.json) - Sempre revalidar
# Garante que o SPA carregue o HTML mais recente
location ~* /app/.*\.(html|json)$ {
    add_header Cache-Control "no-cache, must-revalidate";
    expires 0;
}

# Assets com hash do Vite (JS, CSS) - Cache longo (immutable)
# Arquivos como main.a1b2c3.js nunca mudam - cache 1 ano
location ~* /app/assets/.*\.(js|css)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Imagens e fontes - Cache médio (30 dias)
location ~* /app/.*\.(png|jpg|jpeg|gif|webp|svg|ico|woff|woff2|ttf|eot)$ {
    add_header Cache-Control "public, max-age=2592000";
}
